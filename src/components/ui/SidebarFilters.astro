---
const { data } = Astro.props;
const currentCategory = Astro.url.searchParams.get("category");
---

<!-- Filter Backdrop (Mobile Only) -->
<div
  id="sidebar-filter-backdrop"
  class="fixed inset-0 bg-gray-900/50 z-40 lg:hidden opacity-0 pointer-events-none transition-opacity duration-300"
>
</div>

<div
  id="sidebar-filter"
  class="fixed lg:relative max-lg:top-0 max-lg:left-0 max-lg:h-full max-lg:w-[85vw] max-lg:max-w-sm max-lg:z-50 lg:flex w-full lg:w-80 lg:flex-col max-lg:bg-white transition-transform duration-300 max-lg:-translate-x-full max-lg:shadow-2xl overflow-y-auto"
>
  <div
    class="flex lg:sticky lg:top-24 flex-col gap-y-6 bg-white lg:shadow-sm px-6 py-8 relative lg:border lg:border-gray-100 lg:rounded-2xl h-full"
  >
    <!-- Mobile Close Button -->
    <button
      id="button-modal-filter-close"
      class="lg:hidden absolute top-4 right-4 p-2 hover:bg-gray-100 rounded-xl transition-colors"
      type="button"
      aria-label="Close filter modal"
    >
      <span
        class="size-6 flex items-center justify-center text-gray-900 font-bold"
        >âœ•</span
      >
    </button>

    <div>
      <h3
        class="text-lg font-black tracking-tighter text-gray-900 mb-6 flex items-center gap-2"
      >
        <span class="w-2 h-6 bg-blue-600 rounded-full"></span>
        Product Categories
      </h3>

      <nav>
        <ul class="flex flex-col gap-y-1">
          <!-- All Products Option -->
          <li>
            <a
              href="/products"
              class={`flex items-center justify-between px-4 py-3 rounded-xl text-md font-bold transition-all duration-200 group ${!currentCategory || currentCategory === "all" ? "bg-blue-600 text-white shadow-lg shadow-blue-100" : "text-gray-500 hover:bg-gray-50 hover:text-gray-900"}`}
            >
              <span class="tracking-tight">All Solutions</span>
              <span
                class={`${!currentCategory || currentCategory === "all" ? "text-blue-200" : "text-gray-300 group-hover:text-gray-400"}`}
              >
                ({data.count})
              </span>
            </a>
          </li>

          <!-- Dynamic Categories -->
          {
            data.categories.map((cat) => (
              <li>
                <a
                  href={`/products?category=${encodeURIComponent(cat.name)}`}
                  class={`flex items-center justify-between px-4 py-3 rounded-xl text-md font-bold transition-all duration-200 group ${currentCategory === cat.name ? "bg-blue-600 text-white shadow-lg shadow-blue-100" : "text-gray-500 hover:bg-gray-50 hover:text-gray-900"}`}
                >
                  <span class="tracking-tight">{cat.name}</span>
                  <span
                    class={`${currentCategory === cat.name ? "text-blue-200" : "text-gray-300 group-hover:text-gray-400"}`}
                  >
                    ({cat.count})
                  </span>
                </a>
              </li>
            ))
          }
        </ul>
      </nav>
    </div>
  </div>
</div>

<script>
  /**
   * Fungsi untuk mengatur sidebar mobile
   */
  function initSidebar() {
    console.log("Initializing Sidebar..."); // Debugging

    // Cari elemen berdasarkan ID
    const sidebar = document.getElementById("sidebar-filter");
    const backdrop = document.getElementById("sidebar-filter-backdrop");
    const openBtn = document.getElementById("button-modal-filter-open");
    const closeBtn = document.getElementById("button-modal-filter-close");

    if (!sidebar || !backdrop) {
      console.warn("Sidebar elements not found!");
      return;
    }

    const openSidebar = () => {
      console.log("Opening Sidebar");
      // Gunakan kombinasi penghapusan class translate dan penambahan opacity
      sidebar.classList.remove("max-lg:-translate-x-full");
      backdrop.classList.remove("opacity-0", "pointer-events-none");
      backdrop.classList.add("opacity-100");
      document.body.style.overflow = "hidden";
    };

    const closeSidebar = () => {
      console.log("Closing Sidebar");
      sidebar.classList.add("max-lg:-translate-x-full");
      backdrop.classList.add("opacity-0", "pointer-events-none");
      backdrop.classList.remove("opacity-100");
      document.body.style.overflow = "";
    };

    // Pasang Event Listeners
    openBtn?.addEventListener("click", (e) => {
      e.preventDefault();
      openSidebar();
    });

    closeBtn?.addEventListener("click", (e) => {
      e.preventDefault();
      closeSidebar();
    });

    backdrop?.addEventListener("click", closeSidebar);

    // Otomatis tutup jika link diklik (opsional tapi bagus untuk mobile)
    const links = sidebar.querySelectorAll("a");
    links.forEach((link) => {
      link.addEventListener("click", () => {
        // Beri sedikit delay agar user sempat melihat feedback klik
        setTimeout(closeSidebar, 200);
      });
    });
  }

  // Jalankan saat load pertama kali
  initSidebar();

  // Jalankan setiap kali navigasi Astro (View Transitions) terjadi
  document.addEventListener("astro:page-load", initSidebar);
</script>
